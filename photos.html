<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>照片集展示</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      /* 增加上边距给首页按钮留出空间，虽然按钮是fixed，但视觉上可能需要 */
      padding: 60px 20px 20px 20px; 
      background: linear-gradient(135deg, #f0f8ff, #e6f2ff);
      min-height: 100vh;
      position: relative; /* 添加相对定位，以备不时之需，但对fixed按钮非必需 */
    }

    /* 首页按钮样式 */
    .home-button {
      position: fixed; /* 固定在视口左上角 */
      top: 15px;
      left: 15px;
      z-index: 10; /* 确保在内容之上，但在预览之下 */
      background-color: rgba(0, 100, 200, 0.7);
      color: white;
      padding: 8px 15px;
      text-decoration: none;
      border-radius: 5px;
      font-size: 14px;
      transition: background-color 0.3s ease;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    .home-button:hover {
      background-color: rgba(0, 100, 200, 0.9);
    }

    .group {
       background: white;
      margin-bottom: 40px;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      animation: fadeIn 1s ease;
    }
    .group-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      margin-bottom: 15px; /* 给标题和图片之间增加一些间距 */
    }
    .group h2 {
      margin: 0;
      font-size: 26px;
      color: #444;
      padding: 10px 0;
    }
    .toggle-btn {
      font-size: 24px;
      background: none;
      border: none;
      cursor: pointer;
      color: #666;
    }
    .photos {
      display: flex;
      flex-wrap: wrap;
      gap: 15px; /* 图片间距 */
      transition: all 0.3s ease;
      /* justify-content: center; /* 如果想让图片行居中对齐可以取消注释 */
    }

    /* --- 方形布局改动 Start --- */
    .photo-container {
      position: relative;
      /* 移除 flex 相关属性 */
      /* flex: 1 1 150px; */
      /* max-width: 200px; */
      width: 180px;  /* 设置固定宽度 */
      height: 180px; /* 设置固定高度，与宽度相等形成正方形 */
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      cursor: pointer;
      transition: transform 0.3s, box-shadow 0.3s;
    }
    /* --- 方形布局改动 End --- */

    .photo {
      width: 100%;
      height: 100%;
      background-size: cover; /* 保持覆盖，自动裁剪 */
      background-position: center; /* 图片居中显示 */
      transition: transform 0.3s;
    }
    .photo-caption {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(0,0,0,0.7);
      color: white;
      padding: 8px;
      font-size: 14px;
      transform: translateY(100%);
      transition: transform 0.3s;
      text-align: center; /* 标题居中 */
    }
    .photo-container:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(0,100,200,0.2);
    }
    .photo-container:hover .photo-caption {
      transform: translateY(0);
    }
    .loading {
      background: #f0f0f0;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .loading::after {
      content: "加载中...";
      color: #999;
    }

    /* 弹窗预览 */
    #preview {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0, 0, 0, 0.9);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000; /* 确保预览在最上层 */
      animation: fadeIn 0.5s ease;
    }
    .preview-container {
      position: relative;
      max-width: 90%;
      max-height: 90%;
      text-align: center;
    }
    #preview-img {
      max-width: 100%;
      max-height: 80vh;
      border-radius: 10px;
      animation: zoomIn 0.5s ease;
    }
    #preview-caption {
      color: white;
      margin-top: 10px;
      font-size: 18px;
    }
    .nav-btn {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(255,255,255,0.3);
      color: white;
      border: none;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      font-size: 24px;
      cursor: pointer;
      transition: all 0.3s;
    }
    .nav-btn:hover {
      background: rgba(255,255,255,0.5);
    }
    #prev-btn {
      left: 20px;
    }
    #next-btn {
      right: 20px;
    }
    #close-btn {
      position: absolute;
      top: 20px;
      right: 20px;
      background: none;
      border: none;
      color: white;
      font-size: 30px;
      cursor: pointer;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    @keyframes zoomIn {
      from { transform: scale(0.7); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }

    /* 手机端适配 */
    @media (max-width: 600px) {
      body {
        padding: 70px 10px 10px 10px; /* 调整手机端padding */
      }
      .home-button {
          top: 10px;
          left: 10px;
          padding: 6px 10px;
          font-size: 13px;
      }
      .photos {
        justify-content: center; /* 图片在行内居中 */
        gap: 10px; /* 手机端间距小一点 */
      }
      .photo-container {
        /* --- 移动端方形布局改动 --- */
        width: calc(50% - 5px); /* 让一行显示两个正方形，减去一半的gap */
        /* 移除固定高度 */
        /* height: 200px; */
        aspect-ratio: 1 / 1; /* 关键：保持1:1的宽高比 */
        /* 移除flex和max-width，因为现在是固定宽度百分比 */
        /* flex: 1 1 100%; */
        /* max-width: 90%; */
      }
      .nav-btn {
        width: 40px;
        height: 40px;
        font-size: 20px;
      }
      #prev-btn { left: 10px; }
      #next-btn { right: 10px; }
      #close-btn { top: 10px; right: 10px; }
    }

    /* 屏幕更小时，一行只显示一个 */
     @media (max-width: 400px) {
        .photo-container {
           width: 80%; /* 或根据需要调整 */
           /* aspect-ratio: 1 / 1; 继承自上一个断点 */
           margin-left: auto; /* 配合margin-right实现居中（因为父元素是flex且justify-content: center）*/
           margin-right: auto;
        }
     }

  </style>
</head>
<body>

<!-- 首页按键 -->
<a href="index.html" class="home-button">首页</a>

<div id="gallery"></div>

<!-- 放大预览容器 -->
<div id="preview">
  <button id="close-btn" aria-label="关闭预览">&times;</button>
  <button id="prev-btn" class="nav-btn" aria-label="上一张">&#10094;</button>
  <div class="preview-container">
    <img id="preview-img" src="" alt="预览图片">
    <div id="preview-caption"></div>
  </div>
  <button id="next-btn" class="nav-btn" aria-label="下一张">&#10095;</button>
</div>

<script>
  const photoGroups = [
    {
      title: "新版樱花",
      photos: [
        { url: "https://i.imgs.ovh/2025/04/29/r7Aka.png", caption: "随景" },
        { url: "https://i.imgs.ovh/2025/04/29/r7zOe.png", caption: "告示牌1" },
        { url: "https://i.imgs.ovh/2025/04/29/r7VKh.png", caption: "告示牌2" },
        { url: "https://i.imgs.ovh/2025/04/29/r7TrM.png", caption: "小径" }
      ]
    },
    {
      title: "雨水",
      photos: [
        { url: "https://i.imgs.ovh/2025/04/29/r7Sux.png", caption: "垂钓" },
        { url: "https://placekitten.com/406/300", caption: "小猫1" }, // 更新占位图描述
        { url: "https://placekitten.com/407/300", caption: "小猫2" }  // 更新占位图描述
      ]
    },
    {
      title: "第一人称", // 可以换成更合适的标题，比如“风景”
      photos: [
        { url: "https://placekitten.com/408/300", caption: "小猫3" }, // 更新占位图描述
        { url: "https://placekitten.com/409/300", caption: "小猫4" }, // 更新占位图描述
        { url: "https://placekitten.com/410/300", caption: "小猫5" }, // 更新占位图描述
        { url: "https://placekitten.com/411/300", caption: "小猫6" }  // 更新占位图描述
      ]
    }
  ];

  const gallery = document.getElementById('gallery');
  const preview = document.getElementById('preview');
  const previewImg = document.getElementById('preview-img');
  const previewCaption = document.getElementById('preview-caption');
  const closeBtn = document.getElementById('close-btn');
  const prevBtn = document.getElementById('prev-btn');
  const nextBtn = document.getElementById('next-btn');

  let currentGroupIndex = 0;
  let currentPhotoIndex = 0;
  let allPhotos = []; // 用于存储所有照片的位置信息，方便预览导航

  // 初始化照片库
  function initGallery() {
    // 清空之前的映射，以防重复调用
    allPhotos = []; 
    
    photoGroups.forEach((group, groupIndex) => {
      const groupDiv = document.createElement('div');
      groupDiv.className = 'group';
      
      const groupHeader = document.createElement('div');
      groupHeader.className = 'group-header';
      groupHeader.onclick = () => toggleGroup(groupDiv); // 点击头部区域切换
      
      const title = document.createElement('h2');
      title.textContent = group.title;
      
      const toggleBtn = document.createElement('button');
      toggleBtn.className = 'toggle-btn';
      toggleBtn.setAttribute('aria-label', `展开/折叠 ${group.title} 照片组`); // 增加可访问性
      toggleBtn.textContent = '-'; // 默认展开
      // toggleBtn.onclick = (e) => { // 阻止事件冒泡到 groupHeader
      //  e.stopPropagation(); 
      //  toggleGroup(groupDiv); 
      // }; 
      // 注释掉上面，因为点击整个header都可以触发了

      groupHeader.appendChild(title);
      groupHeader.appendChild(toggleBtn);
      groupDiv.appendChild(groupHeader);

      const photosDiv = document.createElement('div');
      photosDiv.className = 'photos';

      group.photos.forEach((photo, photoIndex) => {
        // 存储照片位置信息
        allPhotos.push({ groupIndex, photoIndex });
        
        const photoContainer = document.createElement('div');
        photoContainer.className = 'photo-container loading'; // 初始添加loading类
        
        const photoDiv = document.createElement('div');
        photoDiv.className = 'photo';
        
        const caption = document.createElement('div');
        caption.className = 'photo-caption';
        caption.textContent = photo.caption;
        
        // 图片加载处理
        const img = new Image();
        img.src = photo.url;
        img.onload = () => {
          photoDiv.style.backgroundImage = `url('${photo.url}')`;
          photoContainer.classList.remove('loading'); // 加载成功移除loading
        };
        img.onerror = () => {
          photoContainer.classList.remove('loading'); // 加载失败也移除loading
          photoDiv.style.backgroundColor = '#eee'; // 显示灰色背景
          // 可以添加一个错误提示图标或文字
          photoDiv.innerHTML = '<span style="color:#999; font-size:12px;">加载失败</span>'; 
          caption.textContent = photo.caption + ' (加载失败)';
        };
        
        // 点击图片容器打开预览
        photoContainer.onclick = (e) => {
          // 阻止事件冒泡到 groupHeader 的点击事件
          e.stopPropagation(); 
          openPreview(groupIndex, photoIndex);
        }
        
        photoContainer.appendChild(photoDiv);
        photoContainer.appendChild(caption);
        photosDiv.appendChild(photoContainer);
      });

      groupDiv.appendChild(photosDiv);
      gallery.appendChild(groupDiv);
    });
  }

  // 切换照片组展开/折叠
  function toggleGroup(groupDiv) {
    const photosDiv = groupDiv.querySelector('.photos');
    const toggleBtn = groupDiv.querySelector('.toggle-btn');
    const isHidden = photosDiv.style.display === 'none';
    
    if (isHidden) {
      photosDiv.style.display = 'flex'; // 恢复flex布局
      toggleBtn.textContent = '-';
      toggleBtn.setAttribute('aria-label', `折叠 ${groupDiv.querySelector('h2').textContent} 照片组`);
    } else {
      photosDiv.style.display = 'none';
      toggleBtn.textContent = '+';
      toggleBtn.setAttribute('aria-label', `展开 ${groupDiv.querySelector('h2').textContent} 照片组`);
    }
  }

  // 打开预览
  function openPreview(groupIndex, photoIndex) {
    const globalIndex = findGlobalIndex(groupIndex, photoIndex);
    if (globalIndex === -1) return; // 未找到图片

    currentGroupIndex = groupIndex;
    currentPhotoIndex = photoIndex;
    updatePreview();
    preview.style.display = 'flex';
    document.body.style.overflow = 'hidden'; // 防止背景滚动

     // 更新按钮状态
    updateNavButtons();
  }

  // 更新预览内容
  function updatePreview() {
    const photo = photoGroups[currentGroupIndex].photos[currentPhotoIndex];
    previewImg.src = photo.url;
    previewImg.alt = photo.caption; // 设置alt属性
    previewCaption.textContent = photo.caption;
    
    // 预加载下一张和上一张图片（如果存在）
    preloadAdjacentImages();
  }

  // 关闭预览
  function closePreview() {
    preview.style.display = 'none';
    document.body.style.overflow = ''; // 恢复滚动
  }

  // --- 预览导航逻辑优化 ---

  // 根据 groupIndex 和 photoIndex 找到在 allPhotos 中的全局索引
  function findGlobalIndex(gIndex, pIndex) {
      return allPhotos.findIndex(pos => pos.groupIndex === gIndex && pos.photoIndex === pIndex);
  }

  // 导航到上一张
  function prevPhoto() {
    const currentIndex = findGlobalIndex(currentGroupIndex, currentPhotoIndex);
    if (currentIndex > 0) {
      const prevPos = allPhotos[currentIndex - 1];
      currentGroupIndex = prevPos.groupIndex;
      currentPhotoIndex = prevPos.photoIndex;
      updatePreview();
      updateNavButtons(); // 更新按钮状态
    }
  }

  // 导航到下一张
  function nextPhoto() {
    const currentIndex = findGlobalIndex(currentGroupIndex, currentPhotoIndex);
    if (currentIndex < allPhotos.length - 1) {
      const nextPos = allPhotos[currentIndex + 1];
      currentGroupIndex = nextPos.groupIndex;
      currentPhotoIndex = nextPos.photoIndex;
      updatePreview();
      updateNavButtons(); // 更新按钮状态
    }
  }
  
  // 更新导航按钮的禁用状态
  function updateNavButtons() {
      const currentIndex = findGlobalIndex(currentGroupIndex, currentPhotoIndex);
      prevBtn.disabled = currentIndex <= 0;
      nextBtn.disabled = currentIndex >= allPhotos.length - 1;

      // 可以添加样式来表示禁用状态
      prevBtn.style.opacity = prevBtn.disabled ? 0.5 : 1;
      prevBtn.style.cursor = prevBtn.disabled ? 'default' : 'pointer';
      nextBtn.style.opacity = nextBtn.disabled ? 0.5 : 1;
      nextBtn.style.cursor = nextBtn.disabled ? 'default' : 'pointer';
  }

  // 预加载相邻图片
  function preloadAdjacentImages() {
      const currentIndex = findGlobalIndex(currentGroupIndex, currentPhotoIndex);

      // 预加载下一张
      if (currentIndex < allPhotos.length - 1) {
          const nextPos = allPhotos[currentIndex + 1];
          new Image().src = photoGroups[nextPos.groupIndex].photos[nextPos.photoIndex].url;
      }
      // 预加载上一张
      if (currentIndex > 0) {
          const prevPos = allPhotos[currentIndex - 1];
          new Image().src = photoGroups[prevPos.groupIndex].photos[prevPos.photoIndex].url;
      }
  }
  // --- 导航逻辑优化结束 ---


  // --- 事件监听 ---
  closeBtn.addEventListener('click', closePreview);
  prevBtn.addEventListener('click', prevPhoto);
  nextBtn.addEventListener('click', nextPhoto);
  
  // ESC键 和 左右箭头键 控制预览
  document.addEventListener('keydown', (e) => {
    if (preview.style.display === 'flex') { // 只在预览打开时响应
        if (e.key === 'Escape') {
            closePreview();
        } else if (e.key === 'ArrowLeft') {
            prevPhoto();
        } else if (e.key === 'ArrowRight') {
            nextPhoto();
        }
    }
  });

  // 点击预览背景的暗色区域关闭预览
  preview.addEventListener('click', (e) => {
    // 检查点击的目标是否是 #preview 本身（即背景）
    if (e.target === preview) {
      closePreview();
    }
  });

  // 初始化画廊
  initGallery();
</script>

</body>
</html>
